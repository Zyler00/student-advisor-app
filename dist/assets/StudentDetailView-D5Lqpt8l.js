import{f as y,g as i,q as w,m as k,c as l,a as e,i as C,e as S,t as n,F as D,n as I,h as A,j,v as B,p as E,o as a}from"./index-ccbdet2U.js";import{u as N}from"./advisor-D7NZ8dGp.js";import"./supabase-1JXeVZ6_.js";const V={class:"container mx-auto px-4 py-8"},L={class:"mb-6"},M={key:0,class:"flex justify-center items-center h-64"},H={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},T={class:"block sm:inline"},q={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},z={class:"md:col-span-1"},F={class:"bg-white shadow rounded-lg p-6"},$={class:"flex flex-col items-center"},P=["src"],R={class:"text-xl font-semibold text-black"},U={class:"text-black"},G={class:"mt-6 space-y-4"},J={class:"flex flex-col"},K={class:"font-medium text-black"},O={class:"flex flex-col"},Q={class:"font-medium text-black"},W={class:"flex flex-col"},X={class:"font-medium text-black"},Y={class:"md:col-span-2"},Z={class:"bg-white shadow rounded-lg p-6 mb-6"},ee={key:0,class:"flex justify-center items-center h-32"},te={key:1,class:"text-center py-8 text-gray-500"},se={key:2,class:"space-y-4 max-h-96 overflow-y-auto mb-4"},oe={class:"flex justify-between items-start mb-1"},le={class:"font-medium"},ae={class:"text-xs text-gray-500"},ne={class:"text-black"},re={class:"mt-4"},ie={class:"flex flex-col space-y-2"},de=["disabled"],ue={key:0},ce={key:1},be=y({__name:"StudentDetailView",setup(me){const _=w(),v=N(),f=i(_.params.id),o=i(null),p=i([]),d=i(""),c=i(!0),b=i(!1),m=i(!1),u=i(null);k(async()=>{try{if(!f.value){u.value="ไม่พบรหัสนักศึกษา",c.value=!1;return}const s=await v.fetchStudentById(f.value);if(!s){u.value="ไม่พบข้อมูลนักศึกษา",c.value=!1;return}o.value=s,await g()}catch(s){console.error("Error loading student details:",s),u.value="เกิดข้อผิดพลาดในการโหลดข้อมูลนักศึกษา"}finally{c.value=!1}});const g=async()=>{try{b.value=!0;const s=await v.fetchStudentComments(f.value);p.value=s||[]}catch(s){console.error("Error fetching comments:",s)}finally{b.value=!1}},h=async()=>{if(!d.value.trim()){alert("กรุณากรอกข้อความก่อนส่ง");return}if(!o.value||!o.value.id){console.error("ไม่พบข้อมูลนักศึกษาหรือ ID ของนักศึกษา",o.value),alert("เกิดข้อผิดพลาด: ไม่พบข้อมูลนักศึกษา");return}try{m.value=!0,console.log("กำลังส่งข้อความ:",{studentId:o.value.id,content:d.value,isAdvisorComment:!0}),await v.addStudentComment({studentId:o.value.id,content:d.value,isAdvisorComment:!0}),d.value="",await g()}catch(s){console.error("Error submitting comment:",s),alert("เกิดข้อผิดพลาดในการส่งข้อความ: "+(s instanceof Error?s.message:String(s)))}finally{m.value=!1}},x=s=>s?new Date(s).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return(s,t)=>(a(),l("div",V,[e("div",L,[e("button",{onClick:t[0]||(t[0]=r=>s.$router.back()),class:"flex items-center text-white bg-blue-600 hover:bg-blue-700 py-2 px-4 rounded-lg"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),S(" กลับไปหน้ารายชื่อนักศึกษา ")]))]),c.value?(a(),l("div",M,t[3]||(t[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"},null,-1)]))):u.value?(a(),l("div",H,[t[4]||(t[4]=e("strong",{class:"font-bold"},"เกิดข้อผิดพลาด!",-1)),e("span",T,n(u.value),1)])):o.value?(a(),l("div",q,[e("div",z,[e("div",F,[e("div",$,[e("img",{src:o.value.profileImage||"https://via.placeholder.com/150",class:"h-32 w-32 rounded-full object-cover mb-4",alt:"Profile"},null,8,P),e("h2",R,n(o.value.firstName)+" "+n(o.value.lastName),1),e("p",U,n(o.value.studentId||"ไม่ระบุรหัสนักศึกษา"),1)]),e("div",G,[e("div",J,[t[5]||(t[5]=e("span",{class:"text-sm text-gray-500"},"ภาควิชา",-1)),e("span",K,n(o.value.department||"-"),1)]),e("div",O,[t[6]||(t[6]=e("span",{class:"text-sm text-gray-500"},"อีเมล",-1)),e("span",Q,n(o.value.email||"-"),1)]),e("div",W,[t[7]||(t[7]=e("span",{class:"text-sm text-gray-500"},"เบอร์โทรศัพท์",-1)),e("span",X,n(o.value.phone||"-"),1)])])])]),e("div",Y,[e("div",Z,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold mb-4"},"การสนทนา",-1)),b.value?(a(),l("div",ee,t[8]||(t[8]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"},null,-1)]))):p.value.length===0?(a(),l("div",te," ยังไม่มีการสนทนา ")):(a(),l("div",se,[(a(!0),l(D,null,I(p.value,r=>(a(),l("div",{key:r.id,class:E(["p-3 rounded-lg",r.isAdvisorComment?"bg-blue-50 ml-8":"bg-gray-50 mr-8"])},[e("div",oe,[e("span",le,n(r.isAdvisorComment?"อาจารย์":"นักศึกษา"),1),e("span",ae,n(x(r.createdAt)),1)]),e("p",ne,n(r.content),1)],2))),128))])),e("div",re,[e("form",{onSubmit:A(h,["prevent"])},[e("div",ie,[j(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>d.value=r),class:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"พิมพ์ข้อความถึงนักศึกษา...",required:""},null,512),[[B,d.value]]),e("button",{type:"submit",class:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:m.value},[m.value?(a(),l("span",ue,"กำลังส่ง...")):(a(),l("span",ce,"ส่งข้อความ"))],8,de)])],32)])])])])):C("",!0)]))}});export{be as default};
