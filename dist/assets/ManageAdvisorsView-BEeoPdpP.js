import{f as C,g as i,m as j,c as n,a as e,i as k,F as M,n as S,h as q,j as r,l as _,b as N,v as f,t as d,o as m}from"./index-ccbdet2U.js";import{u as D}from"./advisor-D7NZ8dGp.js";import{s as P}from"./storageService-nzwcPgrf.js";import"./supabase-1JXeVZ6_.js";const $={class:"bg-white shadow overflow-hidden sm:rounded-lg"},E={class:"px-4 py-5 sm:px-6 flex justify-between items-center"},F={class:"border-t border-gray-200 px-4 py-5 sm:p-0"},B={key:0,class:"flex justify-center py-8"},L={key:1,class:"text-center py-8 text-gray-500"},O={key:2,class:"overflow-x-auto"},T={class:"min-w-full divide-y divide-gray-200"},z={class:"bg-white divide-y divide-gray-200"},G={class:"px-6 py-4 whitespace-nowrap"},H={class:"flex items-center"},J={class:"flex-shrink-0 h-10 w-10"},K=["src"],Q={class:"ml-4"},R={class:"text-sm font-medium text-gray-900"},W={class:"px-6 py-4 whitespace-nowrap"},X={class:"text-sm text-gray-900"},Y={class:"px-6 py-4 whitespace-nowrap"},Z={class:"text-sm text-gray-900"},ee={class:"px-6 py-4 whitespace-nowrap"},te={class:"text-sm text-gray-900"},se={class:"px-6 py-4 whitespace-nowrap"},oe={class:"text-sm text-gray-900"},le={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ae=["onClick"],ie=["onClick"],ne={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},re={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},de={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},me={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ue={class:"sm:flex sm:items-start"},pe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"},ce={class:"mt-4 space-y-4"},fe={class:"grid grid-cols-1 gap-y-4 gap-x-4 sm:grid-cols-2"},ge={class:"sm:col-span-2"},ve={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4",role:"alert"},xe={class:"block sm:inline"},be={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ye=["disabled"],Pe=C({__name:"ManageAdvisorsView",setup(we){const p=D(),y=i([]),g=i(!1),a=i(null),u=i(!1),x=i(!1),w=i(!1),c=i(null),s=i({academicPosition:"",firstName:"",lastName:"",department:"",email:"",phone:"",username:"",password:"",profileImage:null});j(async()=>{await b()});const b=async()=>{try{g.value=!0;const l=await p.fetchAdvisors();y.value=l}catch(l){a.value=l.message}finally{g.value=!1}},I=l=>{const t=l.target;t.files&&t.files.length>0&&(s.value.profileImage=t.files[0])},A=async()=>{try{if(x.value=!0,a.value=null,w.value&&c.value){if(s.value.profileImage)try{const t=await P.uploadProfileImage(s.value.profileImage,c.value);await p.updateAdvisorProfile({id:c.value,profileImage:t}),h(),u.value=!1,await b();return}catch(t){console.error("ไม่สามารถอัปโหลดรูปภาพได้:",t),a.value="ไม่สามารถอัปโหลดรูปภาพได้: "+t.message;return}const l={id:c.value,academicPosition:s.value.academicPosition,firstName:s.value.firstName,lastName:s.value.lastName,department:s.value.department||"",email:s.value.email,phone:s.value.phone,username:s.value.username};s.value.password&&Object.assign(l,{password:s.value.password}),await p.updateAdvisorProfile(l)}else{const l={academicPosition:s.value.academicPosition,firstName:s.value.firstName,lastName:s.value.lastName,department:s.value.department,email:s.value.email,phone:s.value.phone,username:s.value.username,password:s.value.password,role:"advisor"},t=await p.createAdvisor(l),o=t&&t.length>0?t[0]:null;if(s.value.profileImage&&o&&o.id)try{const v=await P.uploadProfileImage(s.value.profileImage,o.id);await p.updateAdvisorProfile({id:o.id,profileImage:v})}catch(v){console.error("ไม่สามารถอัปโหลดรูปภาพได้:",v)}}h(),u.value=!1,await b()}catch(l){a.value=l.message}finally{x.value=!1}},V=l=>{w.value=!0,c.value=l.id,s.value={academicPosition:l.academicPosition||"",firstName:l.firstName,lastName:l.lastName,department:l.department||"",email:l.email||"",phone:l.phone||"",username:l.username,password:"",profileImage:null},u.value=!0},U=async l=>{if(confirm("คุณต้องการลบข้อมูลอาจารย์นี้ใช่หรือไม่?"))try{g.value=!0,await p.deleteAdvisor(l),await b()}catch(t){a.value=t.message}finally{g.value=!1}},h=()=>{s.value={academicPosition:"",firstName:"",lastName:"",department:"",email:"",phone:"",username:"",password:"",profileImage:null},w.value=!1,c.value=null,a.value=null};return(l,t)=>(m(),n("div",$,[e("div",E,[t[11]||(t[11]=e("div",null,[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"จัดการข้อมูลอาจารย์"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"},"เพิ่ม แก้ไข และดูรายชื่ออาจารย์ทั้งหมด")],-1)),e("button",{onClick:t[0]||(t[0]=o=>u.value=!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," เพิ่มอาจารย์ ")]),e("div",F,[g.value?(m(),n("div",B,t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"},null,-1)]))):y.value.length===0?(m(),n("div",L," ไม่พบข้อมูลอาจารย์ ")):(m(),n("div",O,[e("table",T,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ชื่อ-นามสกุล "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ตำแหน่งทางวิชาการ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ภาควิชา "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," อีเมล "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ชื่อผู้ใช้ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," จัดการ ")])],-1)),e("tbody",z,[(m(!0),n(M,null,S(y.value,o=>(m(),n("tr",{key:o.id},[e("td",G,[e("div",H,[e("div",J,[e("img",{src:o.profileImage||"https://via.placeholder.com/40",class:"h-10 w-10 rounded-full object-cover",alt:"Profile"},null,8,K)]),e("div",Q,[e("div",R,d(o.firstName)+" "+d(o.lastName),1)])])]),e("td",W,[e("div",X,d(o.academicPosition||"-"),1)]),e("td",Y,[e("div",Z,d(o.department),1)]),e("td",ee,[e("div",te,d(o.email||"-"),1)]),e("td",se,[e("div",oe,d(o.username),1)]),e("td",le,[e("button",{onClick:v=>V(o),class:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-1 px-3 rounded-md text-sm"}," แก้ไข ",8,ae),e("button",{onClick:v=>U(o.id),class:"bg-red-500 hover:bg-red-600 text-white font-medium py-1 px-3 rounded-md text-sm ml-2"}," ลบ ",8,ie)])]))),128))])])]))]),u.value?(m(),n("div",ne,[e("div",re,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[1]||(t[1]=o=>u.value=!1)}),t[26]||(t[26]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",de,[e("form",{onSubmit:q(A,["prevent"])},[e("div",me,[e("div",ue,[e("div",pe,[t[25]||(t[25]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," เพิ่มอาจารย์ใหม่ ",-1)),e("div",ce,[e("div",fe,[e("div",null,[t[15]||(t[15]=e("label",{for:"academicPosition",class:"block text-sm font-medium text-gray-700"},"ตำแหน่งทางวิชาการ",-1)),r(e("select",{id:"academicPosition","onUpdate:modelValue":t[2]||(t[2]=o=>s.value.academicPosition=o),class:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},t[14]||(t[14]=[N('<option value="">ไม่มี</option><option value="อาจารย์">อาจารย์</option><option value="ผู้ช่วยศาสตราจารย์">ผู้ช่วยศาสตราจารย์</option><option value="รองศาสตราจารย์">รองศาสตราจารย์</option><option value="ศาสตราจารย์">ศาสตราจารย์</option>',5)]),512),[[_,s.value.academicPosition]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"department",class:"block text-sm font-medium text-gray-700"},"ภาควิชา",-1)),r(e("select",{id:"department","onUpdate:modelValue":t[3]||(t[3]=o=>s.value.department=o),required:"",class:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},t[16]||(t[16]=[N('<option value="" disabled>เลือกภาควิชา</option><option value="วิศวกรรมคอมพิวเตอร์">วิศวกรรมคอมพิวเตอร์</option><option value="วิศวกรรมไฟฟ้า">วิศวกรรมไฟฟ้า</option><option value="วิศวกรรมเครื่องกล">วิศวกรรมเครื่องกล</option><option value="วิศวกรรมโยธา">วิศวกรรมโยธา</option><option value="วิศวกรรมอุตสาหการ">วิศวกรรมอุตสาหการ</option>',6)]),512),[[_,s.value.department]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"firstName",class:"block text-sm font-medium text-gray-700"},"ชื่อ",-1)),r(e("input",{type:"text",id:"firstName","onUpdate:modelValue":t[4]||(t[4]=o=>s.value.firstName=o),required:"",class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[f,s.value.firstName]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"lastName",class:"block text-sm font-medium text-gray-700"},"นามสกุล",-1)),r(e("input",{type:"text",id:"lastName","onUpdate:modelValue":t[5]||(t[5]=o=>s.value.lastName=o),required:"",class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[f,s.value.lastName]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"อีเมล",-1)),r(e("input",{type:"email",id:"email","onUpdate:modelValue":t[6]||(t[6]=o=>s.value.email=o),class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[f,s.value.email]])]),e("div",null,[t[21]||(t[21]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700"},"เบอร์โทรศัพท์",-1)),r(e("input",{type:"text",id:"phone","onUpdate:modelValue":t[7]||(t[7]=o=>s.value.phone=o),class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[f,s.value.phone]])]),e("div",null,[t[22]||(t[22]=e("label",{for:"username",class:"block text-sm font-medium text-gray-700"},"ชื่อผู้ใช้",-1)),r(e("input",{type:"text",id:"username","onUpdate:modelValue":t[8]||(t[8]=o=>s.value.username=o),required:"",class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[f,s.value.username]])]),e("div",null,[t[23]||(t[23]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"รหัสผ่าน",-1)),r(e("input",{type:"password",id:"password","onUpdate:modelValue":t[9]||(t[9]=o=>s.value.password=o),required:"",class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[f,s.value.password]])]),e("div",ge,[t[24]||(t[24]=e("label",{for:"profileImage",class:"block text-sm font-medium text-gray-700"},"รูปโปรไฟล์",-1)),e("input",{type:"file",id:"profileImage",onChange:I,accept:"image/*",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)])]),a.value?(m(),n("div",ve,[e("span",xe,d(a.value),1)])):k("",!0)])])])]),e("div",be,[e("button",{type:"submit",disabled:x.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm"},d(x.value?"กำลังบันทึก...":"บันทึก"),9,ye),e("button",{type:"button",onClick:t[10]||(t[10]=o=>u.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," ยกเลิก ")])],32)])])])):k("",!0)]))}});export{Pe as default};
