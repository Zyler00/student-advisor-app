import{u as K}from"./advisor-D7NZ8dGp.js";import{f as O,g as n,k as h,m as Q,c as i,a as e,F as S,n as M,e as y,t as l,p as T,o as r}from"./index-ccbdet2U.js";import"./supabase-1JXeVZ6_.js";const U={class:"bg-white shadow overflow-hidden sm:rounded-lg"},W={class:"border-t border-gray-200 px-4 py-5 sm:p-0"},X={key:0,class:"flex justify-center py-8"},Y={key:1},Z={class:"overflow-x-auto"},ee={class:"min-w-full divide-y divide-gray-200"},te={class:"bg-white divide-y divide-gray-200"},se={class:"px-6 py-4 whitespace-nowrap"},ae={class:"flex items-center"},le={class:"flex-shrink-0 h-10 w-10"},oe=["src"],ne={class:"ml-4"},de={class:"text-sm font-medium text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap"},re={class:"text-sm text-gray-900"},ce={class:"px-6 py-4 whitespace-nowrap"},ue={class:"text-sm text-gray-900"},me={class:"px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},xe={class:"flex-1 flex justify-between sm:hidden"},pe=["disabled"],ge=["disabled"],ve={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},he={class:"text-sm text-gray-700"},ye={class:"font-medium"},fe={class:"font-medium"},we={class:"font-medium"},_e={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},be=["disabled"],ke=["onClick"],Se=["disabled"],Me={class:"grid grid-cols-1 md:grid-cols-5 gap-4 px-4 py-5 sm:px-6"},Pe={class:"bg-white overflow-hidden shadow rounded-lg"},Ce={class:"px-4 py-5 sm:p-6"},Ae={class:"mt-1 text-3xl font-semibold text-gray-900"},Ne={class:"bg-white overflow-hidden shadow rounded-lg"},Te={class:"px-4 py-5 sm:p-6"},ze={class:"mt-1 text-3xl font-semibold text-yellow-500"},$e={class:"bg-white overflow-hidden shadow rounded-lg"},je={class:"px-4 py-5 sm:p-6"},Be={class:"mt-1 text-3xl font-semibold text-blue-500"},De={class:"bg-white overflow-hidden shadow rounded-lg"},Ie={class:"px-4 py-5 sm:p-6"},Ee={class:"mt-1 text-3xl font-semibold text-green-500"},Le={class:"bg-white overflow-hidden shadow rounded-lg"},Ve={class:"px-4 py-5 sm:p-6"},Fe={class:"mt-1 text-3xl font-semibold text-red-500"},Re={class:"overflow-x-auto mt-4"},He={class:"min-w-full divide-y divide-gray-200"},qe={class:"bg-white divide-y divide-gray-200"},Ge={class:"px-6 py-4 whitespace-nowrap"},Je={class:"text-sm text-gray-900"},Ke={class:"px-6 py-4 whitespace-nowrap"},Oe={class:"text-sm text-gray-900"},Qe={class:"px-6 py-4 whitespace-nowrap"},Ue={class:"text-sm text-gray-900"},We={class:"px-6 py-4 whitespace-nowrap"},Xe={class:"text-sm text-gray-900"},Ye={class:"px-6 py-4 whitespace-nowrap"},at=O({__name:"SummaryView",setup(Ze){const x=K(),u=n([]),P=n([]),C=n([]),d=n([]),f=n(!1),p=n(null),w=n(new Map),_=n(new Map),b=n(new Map),o=n(1),m=n(5),c=n({total:0,pending:0,scheduled:0,confirmed:0,cancelled:0}),g=h(()=>Math.ceil(u.value.length/m.value)),z=h(()=>{const s=[];let a=Math.max(1,o.value-Math.floor(2.5)),v=Math.min(g.value,a+5-1);v-a+1<5&&(a=Math.max(1,v-5+1));for(let k=a;k<=v;k++)s.push(k);return s}),$=h(()=>{const s=(o.value-1)*m.value,t=s+m.value;return u.value.slice(s,t)}),j=h(()=>d.value);Q(async()=>{f.value=!0;try{await B(),await D(),await I(),await E(),L(),V(),console.log("จำนวนการนัดหมายที่ดึงมาได้:",d.value.length),console.log("สรุปการนัดหมาย:",c.value)}catch(s){console.error("เกิดข้อผิดพลาดในการโหลดข้อมูล:",s)}finally{f.value=!1}});const B=async()=>{try{const s=await x.fetchAdvisors();u.value=s,w.value=new Map,u.value.forEach(t=>{w.value.set(t.id,t)})}catch(s){p.value=s.message}},D=async()=>{try{const s=await x.fetchStudents();P.value=s,_.value=new Map,P.value.forEach(t=>{_.value.set(t.id,t)})}catch(s){p.value=s.message}},I=async()=>{try{const s=await x.fetchAllRelations();C.value=s}catch(s){p.value=s.message}},E=async()=>{try{const s=await x.fetchAllAppointments();d.value=s}catch(s){p.value=s.message}},L=()=>{b.value=new Map,C.value.forEach(s=>{const t=b.value.get(s.advisorId)||0;b.value.set(s.advisorId,t+1)})},V=()=>{console.log("กำลังคำนวณสรุปการนัดหมาย จากข้อมูลทั้งหมด:",d.value.length,"รายการ"),c.value={total:d.value.length,pending:d.value.filter(s=>s.status==="pending").length,scheduled:d.value.filter(s=>s.status==="scheduled").length,confirmed:d.value.filter(s=>s.status==="confirmed").length,cancelled:d.value.filter(s=>s.status==="cancelled").length},console.log("สรุปการนัดหมายที่คำนวณได้:",c.value)},F=s=>{const t=w.value.get(s);return t?`${t.academicPosition?t.academicPosition+" ":""}${t.firstName} ${t.lastName}`:"ไม่พบข้อมูล"},R=s=>{const t=_.value.get(s);return t?`${t.firstName} ${t.lastName}`:"ไม่พบข้อมูล"},H=s=>{if(!s)return"-";try{return new Date(s).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("เกิดข้อผิดพลาดในการแปลงวันที่:",t,s),"-"}},q=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"scheduled":return"bg-blue-100 text-blue-800";case"confirmed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},G=s=>{switch(s){case"pending":return"รอการยืนยัน";case"scheduled":return"กำหนดเวลาแล้ว";case"confirmed":return"ยืนยันแล้ว";case"cancelled":return"ยกเลิก";default:return s}},A=()=>{o.value>1&&o.value--},N=()=>{o.value<g.value&&o.value++},J=s=>{o.value=s};return(s,t)=>(r(),i("div",U,[t[16]||(t[16]=e("div",{class:"px-4 py-5 sm:px-6"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"สรุปข้อมูล"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"},"รายงานสรุปข้อมูลอาจารย์ที่ปรึกษาและการนัดหมาย")],-1)),e("div",W,[f.value?(r(),i("div",X,t[0]||(t[0]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"},null,-1)]))):(r(),i("div",Y,[t[14]||(t[14]=e("div",{class:"px-4 py-5 sm:px-6"},[e("h4",{class:"text-md font-medium text-gray-900"},"รายการอาจารย์ที่ปรึกษา")],-1)),e("div",Z,[e("table",ee,[t[1]||(t[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ชื่อ-นามสกุล "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ตำแหน่งทางวิชาการ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ภาควิชา ")])],-1)),e("tbody",te,[(r(!0),i(S,null,M($.value,a=>(r(),i("tr",{key:a.id},[e("td",se,[e("div",ae,[e("div",le,[e("img",{src:a.profileImage||"https://via.placeholder.com/40",class:"h-10 w-10 rounded-full object-cover",alt:"Profile"},null,8,oe)]),e("div",ne,[e("div",de,l(a.firstName)+" "+l(a.lastName),1)])])]),e("td",ie,[e("div",re,l(a.academicPosition||"-"),1)]),e("td",ce,[e("div",ue,l(a.department),1)])]))),128))])])]),e("div",me,[e("div",xe,[e("button",{onClick:A,disabled:o.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," ก่อนหน้า ",8,pe),e("button",{onClick:N,disabled:o.value>=g.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," ถัดไป ",8,ge)]),e("div",ve,[e("div",null,[e("p",he,[t[2]||(t[2]=y(" แสดง ")),e("span",ye,l((o.value-1)*m.value+1),1),t[3]||(t[3]=y(" ถึง ")),e("span",fe,l(Math.min(o.value*m.value,u.value.length)),1),t[4]||(t[4]=y(" จากทั้งหมด ")),e("span",we,l(u.value.length),1),t[5]||(t[5]=y(" รายการ "))])]),e("div",null,[e("nav",_e,[e("button",{onClick:A,disabled:o.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},t[6]||(t[6]=[e("span",{class:"sr-only"},"ก่อนหน้า",-1),e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]),8,be),(r(!0),i(S,null,M(z.value,a=>(r(),i("button",{key:a,onClick:v=>J(a),class:T([a===o.value?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},l(a),11,ke))),128)),e("button",{onClick:N,disabled:o.value>=g.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},t[7]||(t[7]=[e("span",{class:"sr-only"},"ถัดไป",-1),e("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)]),8,Se)])])])]),t[15]||(t[15]=e("div",{class:"px-4 py-5 sm:px-6 mt-8"},[e("h4",{class:"text-md font-medium text-gray-900"},"สรุปการนัดหมาย")],-1)),e("div",Me,[e("div",Pe,[e("div",Ce,[e("dl",null,[t[8]||(t[8]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"การนัดหมายทั้งหมด",-1)),e("dd",Ae,l(c.value.total),1)])])]),e("div",Ne,[e("div",Te,[e("dl",null,[t[9]||(t[9]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"รอการยืนยัน",-1)),e("dd",ze,l(c.value.pending),1)])])]),e("div",$e,[e("div",je,[e("dl",null,[t[10]||(t[10]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"อาจารย์ยืนยันกำหนดการ",-1)),e("dd",Be,l(c.value.scheduled),1)])])]),e("div",De,[e("div",Ie,[e("dl",null,[t[11]||(t[11]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"ยืนยันแล้ว",-1)),e("dd",Ee,l(c.value.confirmed),1)])])]),e("div",Le,[e("div",Ve,[e("dl",null,[t[12]||(t[12]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"ยกเลิก",-1)),e("dd",Fe,l(c.value.cancelled),1)])])])]),e("div",Re,[e("table",He,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," อาจารย์ที่ปรึกษา "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," นักศึกษา "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," หัวข้อ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," วันที่นัดหมาย "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," สถานะ ")])],-1)),e("tbody",qe,[(r(!0),i(S,null,M(j.value,a=>(r(),i("tr",{key:a.id},[e("td",Ge,[e("div",Je,l(F(a.advisorId)),1)]),e("td",Ke,[e("div",Oe,l(R(a.studentId)),1)]),e("td",Qe,[e("div",Ue,l(a.topic||a.title),1)]),e("td",We,[e("div",Xe,l(H(a.appointmentDate||a.startTime)),1)]),e("td",Ye,[e("span",{class:T([q(a.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},l(G(a.status)),3)])]))),128))])])])]))])]))}});export{at as default};
