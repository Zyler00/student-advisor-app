import{f as A,g as m,m as B,c as n,a as s,i as C,t as o,h as M,j as x,v as y,o as u}from"./index-ccbdet2U.js";import{u as L}from"./auth-BFFrcDP0.js";import{u as E}from"./advisor-D7NZ8dGp.js";import{s as $}from"./storageService-nzwcPgrf.js";import"./supabase-1JXeVZ6_.js";const q={class:"bg-white shadow overflow-hidden sm:rounded-lg"},z={class:"border-t border-gray-200"},H={key:0,class:"flex justify-center py-8"},R={key:1,class:"px-4 py-5 sm:px-6"},F={class:"grid grid-cols-1 gap-8 md:grid-cols-2"},O={class:"bg-white overflow-hidden shadow rounded-lg"},T={class:"px-4 py-5 sm:px-6 flex justify-between items-center"},G={class:"border-t border-gray-200 px-4 py-5 sm:p-0"},J={class:"flex justify-center py-5"},K={class:"relative"},Q=["src"],W={class:"sm:divide-y sm:divide-gray-200"},X={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},Y={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},Z={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},ss={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},ts={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},es={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},os={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},ls={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},is={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},as={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},ds={class:"bg-white overflow-hidden shadow rounded-lg"},rs={class:"border-t border-gray-200 px-4 py-5 sm:p-0"},ms={key:0,class:"flex justify-center items-center h-64"},ns={key:1},us={class:"flex justify-center py-5"},gs={class:"relative"},cs=["src"],ps={class:"sm:divide-y sm:divide-gray-200"},fs={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},vs={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},xs={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},ys={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},bs={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},hs={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},ws={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},_s={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},ks={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},Ns={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},js={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Is={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Us={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ps={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Cs={class:"sm:flex sm:items-start"},Vs={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"},Ds={class:"mt-4 space-y-4"},Ss={class:"flex justify-center"},As={class:"relative"},Bs=["src"],Ms={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ls={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4",role:"alert"},Es={class:"block sm:inline"},$s={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},qs=["disabled"],Gs=A({__name:"ProfileView",setup(zs){const c=L(),V=E(),d=m(null),i=m(null),b=m(!1),g=m(null),p=m(!1),f=m(!1),h=m(null),v=m(null),l=m({firstName:"",lastName:"",email:"",phone:""});B(async()=>{await w()});const w=async()=>{try{b.value=!0;const e=await c.fetchUserProfile();if(!e){g.value="ไม่พบข้อมูลผู้ใช้";return}if(d.value=e,e.advisorId){const t=await V.fetchAdvisorById(e.advisorId);i.value=t}l.value={firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",phone:e.phone||""}}catch(e){g.value=e.message}finally{b.value=!1}},D=e=>{const t=e.target;if(t.files&&t.files.length>0){const r=t.files[0];v.value=r,h.value=URL.createObjectURL(r)}},S=async()=>{var e;try{f.value=!0,g.value=null;const t={firstName:l.value.firstName,lastName:l.value.lastName,email:l.value.email,phone:l.value.phone};if(v.value)try{const r=await $.uploadProfileImage(v.value,((e=c.user)==null?void 0:e.id)||"unknown-user");await c.updateUserProfile({...t,profileImage:r})}catch(r){console.error("ไม่สามารถอัปโหลดรูปภาพได้:",r),await c.updateUserProfile(t)}else await c.updateUserProfile(t);p.value=!1,await w(),h.value=null,v.value=null}catch(t){g.value=t.message||"เกิดข้อผิดพลาดในการอัปเดตโปรไฟล์"}finally{f.value=!1}};return(e,t)=>{var r,_,k,N,j,I,U,P;return u(),n("div",q,[t[28]||(t[28]=s("div",{class:"px-4 py-5 sm:px-6"},[s("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"ข้อมูลส่วนตัว"),s("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"},"ข้อมูลส่วนตัวและข้อมูลอาจารย์ที่ปรึกษาของคุณ")],-1)),s("div",z,[b.value?(u(),n("div",H,t[7]||(t[7]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"},null,-1)]))):(u(),n("div",R,[s("div",F,[s("div",O,[s("div",T,[t[8]||(t[8]=s("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"ข้อมูลนักศึกษา",-1)),s("button",{onClick:t[0]||(t[0]=a=>p.value=!0),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," แก้ไขข้อมูล ")]),s("div",G,[s("div",J,[s("div",K,[s("img",{src:((r=d.value)==null?void 0:r.profileImage)||"https://via.placeholder.com/150",class:"h-32 w-32 rounded-full object-cover",alt:"Profile"},null,8,Q)])]),s("dl",W,[s("div",X,[t[9]||(t[9]=s("dt",{class:"text-sm font-medium text-gray-500"},"รหัสนักศึกษา",-1)),s("dd",Y,o((_=d.value)==null?void 0:_.studentId),1)]),s("div",Z,[t[10]||(t[10]=s("dt",{class:"text-sm font-medium text-gray-500"},"ชื่อ-นามสกุล",-1)),s("dd",ss,o((k=d.value)==null?void 0:k.firstName)+" "+o((N=d.value)==null?void 0:N.lastName),1)]),s("div",ts,[t[11]||(t[11]=s("dt",{class:"text-sm font-medium text-gray-500"},"ภาควิชา",-1)),s("dd",es,o((j=d.value)==null?void 0:j.department),1)]),s("div",os,[t[12]||(t[12]=s("dt",{class:"text-sm font-medium text-gray-500"},"อีเมล",-1)),s("dd",ls,o(((I=d.value)==null?void 0:I.email)||"-"),1)]),s("div",is,[t[13]||(t[13]=s("dt",{class:"text-sm font-medium text-gray-500"},"เบอร์โทรศัพท์",-1)),s("dd",as,o(((U=d.value)==null?void 0:U.phone)||"-"),1)])])])]),s("div",ds,[t[20]||(t[20]=s("div",{class:"px-4 py-5 sm:px-6"},[s("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"อาจารย์ที่ปรึกษา")],-1)),s("div",rs,[i.value?(u(),n("div",ns,[s("div",us,[s("div",gs,[s("img",{src:i.value.profileImage||"https://via.placeholder.com/150",class:"h-32 w-32 rounded-full object-cover",alt:"Advisor Profile"},null,8,cs)])]),s("dl",ps,[s("div",fs,[t[15]||(t[15]=s("dt",{class:"text-sm font-medium text-gray-500"},"ชื่อ-นามสกุล",-1)),s("dd",vs,o(i.value.title)+" "+o(i.value.firstName)+" "+o(i.value.lastName),1)]),s("div",xs,[t[16]||(t[16]=s("dt",{class:"text-sm font-medium text-gray-500"},"ตำแหน่ง",-1)),s("dd",ys,o(i.value.position),1)]),s("div",bs,[t[17]||(t[17]=s("dt",{class:"text-sm font-medium text-gray-500"},"ภาควิชา",-1)),s("dd",hs,o(i.value.department),1)]),s("div",ws,[t[18]||(t[18]=s("dt",{class:"text-sm font-medium text-gray-500"},"อีเมล",-1)),s("dd",_s,o(i.value.email||"-"),1)]),s("div",ks,[t[19]||(t[19]=s("dt",{class:"text-sm font-medium text-gray-500"},"เบอร์โทรศัพท์",-1)),s("dd",Ns,o(i.value.phone||"-"),1)])])])):(u(),n("div",ms,t[14]||(t[14]=[s("p",{class:"text-sm text-gray-500"},"ยังไม่มีอาจารย์ที่ปรึกษา",-1)])))])])])]))]),p.value?(u(),n("div",js,[s("div",Is,[s("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[1]||(t[1]=a=>p.value=!1)}),t[27]||(t[27]=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),s("div",Us,[s("form",{onSubmit:M(S,["prevent"])},[s("div",Ps,[s("div",Cs,[s("div",Vs,[t[26]||(t[26]=s("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," แก้ไขข้อมูลส่วนตัว ",-1)),s("div",Ds,[s("div",Ss,[s("div",As,[s("img",{src:h.value||((P=d.value)==null?void 0:P.profileImage)||"https://via.placeholder.com/150",class:"h-32 w-32 rounded-full object-cover",alt:"Profile Preview"},null,8,Bs),t[21]||(t[21]=s("label",{for:"profile-image",class:"absolute bottom-0 right-0 bg-indigo-600 rounded-full p-1 cursor-pointer"},[s("svg",{class:"h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z","clip-rule":"evenodd"})])],-1)),s("input",{type:"file",id:"profile-image",onChange:D,accept:"image/*",class:"hidden"},null,32)])]),s("div",Ms,[s("div",null,[t[22]||(t[22]=s("label",{for:"firstName",class:"block text-sm font-medium text-gray-700"},"ชื่อ",-1)),x(s("input",{type:"text",id:"firstName","onUpdate:modelValue":t[2]||(t[2]=a=>l.value.firstName=a),required:"",class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[y,l.value.firstName]])]),s("div",null,[t[23]||(t[23]=s("label",{for:"lastName",class:"block text-sm font-medium text-gray-700"},"นามสกุล",-1)),x(s("input",{type:"text",id:"lastName","onUpdate:modelValue":t[3]||(t[3]=a=>l.value.lastName=a),required:"",class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[y,l.value.lastName]])])]),s("div",null,[t[24]||(t[24]=s("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"อีเมล",-1)),x(s("input",{type:"email",id:"email","onUpdate:modelValue":t[4]||(t[4]=a=>l.value.email=a),class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[y,l.value.email]])]),s("div",null,[t[25]||(t[25]=s("label",{for:"phone",class:"block text-sm font-medium text-gray-700"},"เบอร์โทรศัพท์",-1)),x(s("input",{type:"tel",id:"phone","onUpdate:modelValue":t[5]||(t[5]=a=>l.value.phone=a),class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[y,l.value.phone]])]),g.value?(u(),n("div",Ls,[s("span",Es,o(g.value),1)])):C("",!0)])])])]),s("div",$s,[s("button",{type:"submit",disabled:f.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm"},o(f.value?"กำลังบันทึก...":"บันทึก"),9,qs),s("button",{type:"button",onClick:t[6]||(t[6]=a=>p.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," ยกเลิก ")])],32)])])])):C("",!0)])}}});export{Gs as default};
